"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[2237],{49250:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var s=n(15671),a=n(43144),o=n(60136),i=n(27277),r=n(72791),l=n(30368),c=n(29310),d=n(1413),u=n(66818),m=n(61855),h=n(58768),p=n(13832),g=n(31773),f=n(93070),x=n(2556),v=n(78347),j=n(35796),y=n(79286),b=n(82622),Z=n(68747),k=n(80184),w=function(e){(0,o.Z)(n,e);var t=(0,i.Z)(n);function n(e){var a;return(0,s.Z)(this,n),(a=t.call(this,e)).state={value:"",newaddress:""},a}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){function e(e){return document.getElementById(e)}var t=new window.BMap.Map("l-map");t.centerAndZoom("\u5317\u4eac",12);var n=new window.BMap.Autocomplete({input:"suggestId1",location:t});this.ac=n;var s,a=this;n.addEventListener("onhighlight",(function(t){var n="",s=t.fromitem.value,a="";t.fromitem.index>-1&&(a=s.province+s.city+s.district+s.street+s.business),n="FromItem<br />index = "+t.fromitem.index+"<br />value = "+a,a="",t.toitem.index>-1&&(a=(s=t.toitem.value).province+s.city+s.district+s.street+s.business),n+="<br />ToItem<br />index = "+t.toitem.index+"<br />value = "+a,e("searchResultPanel").innerHTML=n})),n.addEventListener("onconfirm",(function(n){var o=n.item.value;s=o.province+o.city+o.district+o.street+o.business,e("searchResultPanel").innerHTML="onconfirm<br />index = "+n.item.index+"<br />myValue = "+s,function(){function e(){var e=n.getResults().getPoi(0).point;a.setBizValueForPoint(e),console.log(e);e.lng,e.lat;t.centerAndZoom(e,18),t.addOverlay(new window.BMap.Marker(e))}t.clearOverlays();var n=new window.BMap.LocalSearch(t,{onSearchComplete:e});a.setState({newaddress:s}),n.search(s)}()}))}},{key:"componentWillReceiveProps",value:function(e){1==this.props.istrue&&"null"!==e.address&&e.address&&(this.ac.setInputValue(e.address),this.props.changeData())}},{key:"setBizValueForPoint",value:function(e){var t=this,n=new window.BMap.Geocoder,s=e.lng,a=e.lat;n.getLocation(e,(function(e){var n=e.addressComponents;console.log(n);var o=t.state.newaddress;t.props.getMap({lon:s,lat:a,addr:o})}))}},{key:"setBizValue",value:function(e){var t=e.point;this.setBizValueForPoint(t)}},{key:"addrSearch",value:function(e){(new window.BMap.Geocoder).getPoint(e,(function(e){e?(this.setBizValueForPoint(e),this.map.clearOverlays(),this.map.centerAndZoom(e,this.zoomSize),this.marker=new window.BMap.Marker(e),this.marker.enableDragging(),this.map.addOverlay(this.marker),this.marker.addEventListener("dragend",this.setBizValue)):console.log("search click no results!")}))}},{key:"render",value:function(){this.props.address;return(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{id:"r-result",children:(0,k.jsx)("input",{type:"text",id:"suggestId1",size:"20",style:{width:"100%",height:30,color:"#2A2B40",background:"none",padding:"4px 11px",border:"1px solid #d9d9d9"},placeholder:"\u8bf7\u8f93\u5165\u5730\u5740"})}),(0,k.jsx)("div",{id:"l-map"}),(0,k.jsx)("div",{id:"searchResultPanel",style:{border:"1px solid #C0C0C0",width:150,height:"auto",position:"relative",display:"none",zIndex:999999999}})]})}}]),n}(r.Component),I=n(5122),C=(n(74569),n(32808),u.Z.Option),S=m.Z.Search,N={labelCol:{xs:{span:28},sm:{span:4}},wrapperCol:{xs:{span:16,offset:4},sm:{span:26,offset:4}}},P={wrapperCol:{xs:{span:16,offset:0},sm:{span:26,offset:0}}},M=h.Z.confirm,U=function(e){(0,o.Z)(n,e);var t=(0,i.Z)(n);function n(e){var a;return(0,s.Z)(this,n),(a=t.call(this,e)).ChildrenChange=function(){a.setState({istrue:!1})},a.onSearch=function(e){console.log(e),e?I.Z.post("system_management/market_subject/customerListByCName?customerType=loadAggregator&tenantName="+e,{}).then((function(e){console.log(e),200==e.data.code?a.setState({dataSource:e.data.data}):p.ZP.info(e.data.msg)})):a.customer()},a.handleOk=function(){console.log("formData:",a.refs.myForm.getFieldValue()),console.log(a.state.mapData);var e=a.state.mapData,t=a.state.contactpenlist;console.log(t);var n=[];1==a.state.edit?a.refs.myForm.validateFields().then((function(s){console.log(s);console.log(a.state.contactpenlist);for(var o=0;o<t.length;o++){console.log(s["jiedian".concat(o)]);var i=void 0;if(i=s["jiedian".concat(o)]?s["jiedian".concat(o)]:t?t[o].nodeId:"",t[o].powerUserNumber.length>0){var r=t[o].powerUserNumber;console.log(r);for(var l=[],c=0;c<r.length;c++)console.log(s["zjiedian".concat(o).concat(c)]),s["zjiedian".concat(o).concat(c)]?l.push(s["zjiedian".concat(o).concat(c)]):l=[];console.log(l),n.push({assetId:i,electricityUserIds:l})}else n.push({assetId:i,electricityUserIds:[]})}if(console.log(n),void 0===n[0].assetId)return p.ZP.info("\u8bf7\u9009\u62e9\u8282\u70b9");0==n.length&&p.ZP.info("\u8bf7\u65b0\u589e\u8282\u70b9\u548c\u7535\u529b\u7528\u6237\u53f7");for(var d=0;d<n.length;d++)return console.log(n[d]),n[d].assetId&&0==n[d].electricityUserIds.length?p.ZP.info("\u8bf7\u8f93\u5165\u7535\u529b\u7528\u6237\u53f7"):I.Z.post("system_management/market_subject/AddCustomer",{address:e.addr,assetModel:n,business:s.business,contact:s.contact,id:"",name:s.username,phone:s.phone,customerType:"loadAggregator"}).then((function(e){console.log(e,"000000"),"\u6210\u529f"==e.data.msg?(a.refs.myForm.resetFields(),a.setState({isModalVisible:!1,address1:"",contactpenlist:[{powerUserNumber:[]}]},(function(){a.customer(),p.ZP.success("\u6dfb\u52a0\u6210\u529f")}))):p.ZP.info(e.data.msg)}))})):0==a.state.edit&&a.refs.myForm.validateFields().then((function(e){console.log(e);console.log(a.state.contactpenlist);for(var s=0;s<t.length;s++){console.log(e["jiedian".concat(s)]);var o=void 0;if(o=e["jiedian".concat(s)]?e["jiedian".concat(s)]:t.length?t[s].nodeId:"",t[s].powerUserNumber.length>0){for(var i=t[s].powerUserNumber,r=[],l=0;l<i.length;l++)console.log(e["zjiedian".concat(s).concat(l)]),e["zjiedian".concat(s).concat(l)]?r.push(e["zjiedian".concat(s).concat(l)]):void 0===e["zjiedian".concat(s).concat(l)]?r.push(i[l]):r=[];console.log(r),n.push({assetId:o,electricityUserIds:r})}else n.push({assetId:o,electricityUserIds:[]})}console.log(n),0==n.length&&p.ZP.info("\u8bf7\u65b0\u589e\u8282\u70b9\u548c\u7535\u529b\u7528\u6237\u53f7");for(var c=0;c<n.length;c++){if(console.log(n[c]),!n[c].assetId||0!=n[c].electricityUserIds.length)return console.log(a.state.mapData),I.Z.post("system_management/market_subject/UpdateCustomer",{address:a.state.address1,assetModel:n,business:e.business,contact:e.contact,id:a.state.id,name:e.username,phone:e.phone,customerType:"loadAggregator"}).then((function(e){console.log(e,"000000"),"\u6210\u529f"==e.data.msg?(a.refs.myForm.resetFields(),a.setState({isModalVisible:!1,address1:"",contactpenlist:[{powerUserNumber:[]}]},(function(){a.customer(),p.ZP.success("\u7f16\u8f91\u6210\u529f")}))):p.ZP.info(e.data.msg)}));p.ZP.info("\u8bf7\u8f93\u5165\u7535\u529b\u7528\u6237\u53f7")}}))},a.showModal=function(){a.setState({isModalVisible:!0,edit:1})},a.handleCancel=function(){a.setState({isModalVisible:!1,address1:"",contactpenlist:[{powerUserNumber:[]}]},(function(){a.refs.myForm.resetFields()}))},a.getMaps=function(e){console.log(e),a.setState({address1:e.addr,mapData:e})},a.handleChange=function(e){a.setState({nodeIds:e})},a.handleCancel1=function(){a.setState({look:!1})},a.handleOk1=function(){a.setState({look:!1})},a.edit=function(e){console.log(e),a.setState({edit:0,isModalVisible:!0,id:e.id,address1:null===e.address?"":e.address,istrue:!0},(function(){I.Z.post("system_management/market_subject/customerById?tenantId="+e.id).then((function(e){if(console.log(e),200==e.data.code){var t=e.data.data;a.setState({contactpenlist:t.nodePowerUserDataList})}})).catch((function(e){console.log(e)})),a.refs.myForm.setFieldsValue({username:e.name,business:e.business,contact:e.contact,phone:e.phone})}))},a.look=function(e){a.setState({look:!0},(function(){I.Z.post("system_management/market_subject/customerById?tenantId="+e.id).then((function(t){if(console.log(t),200==t.data.code){var n=t.data.data;a.setState({ebussindess:n.name,person:e.name,caddress:e.address,tel:e.phone,buss:e.business,nodePowerUserDataList:n.nodePowerUserDataList})}})).catch((function(e){console.log(e)}))}))},a.add=function(e,t){console.log(e,"item");a.state.contactpenlist;e.powerUserNumber.push("")},a.remove=function(e,t,n){a.state.contactpenlist[e].powerUserNumber.splice(t,1)},a.remove1=function(e,t){console.log(e,"index"),console.log(t,"item");var n=a.state.contactpenlist;n.length<=1||(n.splice(e,1),console.log(n))},a.add1=function(){var e=a.state,t=e.contactpenlist,n=e.nodeIds;a.state.contactpenlist.push({value:"\u8282\u70b9",powerUserNumber:[]}),I.Z.post("system_management/node_model/nodeNameList").then((function(e){if(console.log(e),200==e.data.code){for(var t=e.data.data,s=0;s<t.length;s++)n==t[s].id&&t.splice(s,1);console.log(t),a.setState({areas:e.data.data})}})),a.setState({contactpenlist:t})},a.state={isModalVisible:!1,address1:"",dataSource:[],mapData:[],areas:[],contactpenlist:[{text:"124",powerUserNumber:[]}],types:0,edit:0,look:!1,nodePowerUserDataList:[],ebussindess:"",person:"",caddress:"",tel:"",buss:"",loading:!1,nodeIds:"",istrue:!1},a}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){this.customer(),this.nodeNameList()}},{key:"nodeNameList",value:function(){var e=this;I.Z.post("system_management/node_model/nodeNameList").then((function(t){console.log(t),200==t.data.code&&e.setState({areas:t.data.data})}))}},{key:"customer",value:function(){var e=this;this.setState({loading:!0}),I.Z.post("system_management/market_subject/customerList?customerType=loadAggregator",{}).then((function(t){console.log(t),200==t.data.code&&e.setState({dataSource:t.data.data,loading:!1})}))}},{key:"delet",value:function(e){console.log(e);e.id;var t=this;M({title:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",icon:(0,k.jsx)(j.Z,{}),okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",cancelButtonProps:{className:"newbutton",style:{background:"none"}},onOk:function(){console.log("OK"),I.Z.post("system_management/market_subject/DeleteCustomer?customerId="+e.id+"&customerType=loadAggregator").then((function(e){console.log(e,"-----"),200==e.data.code?(p.ZP.success("\u5220\u9664\u6210\u529f"),t.customer()):p.ZP.info(e.data.msg)})).catch((function(e){console.log(e)}))},onCancel:function(){console.log("Cancel")}})}},{key:"render",value:function(){var e=this,t=[{title:"\u5e8f\u53f7",width:"10%",render:function(e,t,n){return"".concat(n+1)}},{title:"\u516c\u53f8\u540d\u79f0",dataIndex:"name",key:"name"},{title:"\u516c\u53f8\u5730\u5740",dataIndex:"address",key:"address"},{title:"\u516c\u53f8\u4e1a\u52a1",dataIndex:"business",key:"business"},{title:"\u8282\u70b9\u6570",dataIndex:"asset_num",key:"asset_num"},{title:"\u7535\u529b\u7528\u6237\u53f7\u6570",dataIndex:"electricity_user_num",key:"electricity_user_num"},{title:"\u8054\u7cfb\u4eba",dataIndex:"contact",key:"contact"},{title:"\u7535\u8bdd",dataIndex:"phone",key:"phone"},{title:"\u64cd\u4f5c",dataIndex:"age",key:"age",render:function(t,n,s,a){return(0,k.jsxs)(g.Z,{size:"middle",children:[(0,k.jsx)("a",{onClick:function(){return e.look(n)},children:"\u67e5\u770b"}),(0,k.jsx)("a",{onClick:function(){return e.edit(n)},children:"\u7f16\u8f91"}),(0,k.jsx)("a",{onClick:function(){return e.delet(n)},children:"\u5220\u9664"})]})}}],n=this.state,s=n.isModalVisible,a=n.address1,o=n.dataSource,i=n.areas,r=n.contactpenlist,l=n.types,c=n.edit,p=n.nodePowerUserDataList,j=n.look,I=n.loading,M=(0,k.jsx)(f.Z.Item,{name:"prefix",noStyle:!0,children:"86"});return(0,k.jsxs)("div",{className:"allcontent allelectric",children:[(0,k.jsxs)("div",{className:"electric",children:[(0,k.jsxs)("div",{className:"electrictitle",children:[(0,k.jsxs)(x.ZP,{type:"primary",onClick:this.showModal,children:[(0,k.jsx)(y.Z,{}),"\u6dfb\u52a0\u865a\u62df\u7535\u5382\u8fd0\u8425\u5546"]}),(0,k.jsx)(S,{placeholder:"\u6309\u516c\u53f8\u540d\u79f0\u641c\u7d22",onSearch:this.onSearch,style:{width:200}})]}),(0,k.jsx)("div",{style:{marginTop:24},children:(0,k.jsx)(v.Z,{dataSource:o,columns:t,loading:I})})]}),(0,k.jsxs)(h.Z,{title:0==c?"\u4fee\u6539":"\u6dfb\u52a0\u865a\u62df\u7535\u5382\u8fd0\u8425\u5546",width:740,visible:s,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",forceRender:!0,onOk:this.handleOk,onCancel:this.handleCancel,children:[(0,k.jsxs)(f.Z,{name:"basics",labelCol:{span:4},wrapperCol:{span:16},ref:"myForm",children:[(0,k.jsx)(f.Z.Item,{label:"\u516c\u53f8\u540d\u79f0",name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u516c\u53f8\u540d\u79f0"}],extra:"\u516c\u53f8\u540d\u79f0\u5373\u4e3a\u7535\u529b\u7528\u6237\u767b\u5f55\u540d\uff0c\u5bc6\u7801\u9ed8\u8ba4\u4e3a!StxnDc0908\uff0c\u53ef\u5728\u767b\u5f55\u9875\u9762\u8fdb\u884c\u5bc6\u7801\u4fee\u6539",children:(0,k.jsx)(m.Z,{})}),(0,k.jsx)(f.Z.Item,{name:"address",label:"\u5730\u5740",children:(0,k.jsx)(w,{getMap:this.getMaps,istrue:this.state.istrue,changeData:this.ChildrenChange,address:a})}),(0,k.jsx)(f.Z.Item,{name:"business",label:"\u516c\u53f8\u4e1a\u52a1",children:(0,k.jsx)(m.Z.TextArea,{showCount:!0,maxLength:200})}),(0,k.jsx)(f.Z.Item,{name:"contact",label:"\u8054\u7cfb\u4eba",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8054\u7cfb\u4eba"}],children:(0,k.jsx)(m.Z,{})}),(0,k.jsx)(f.Z.Item,{name:"phone",label:"\u7535\u8bdd",rules:[{required:!0,label:"\u7535\u8bdd\u53f7\u7801",message:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u53f7\u7801"},{required:!1,label:"\u7535\u8bdd\u53f7\u7801",pattern:new RegExp(/^1(3|4|5|6|7|8|9)\d{9}$/,"g"),message:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u53f7\u7801"}],children:(0,k.jsx)(m.Z,{addonBefore:M,style:{width:"100%"}})}),r.map((function(t,n){return(0,k.jsxs)(f.Z.Item,(0,d.Z)((0,d.Z)({style:{marginBottom:"0px"},label:0==n?"\u8282\u70b9":""},0===n?P:N),{},{children:[(0,k.jsx)(f.Z.Item,{name:"jiedian"+n,style:{marginBottom:"0x"},children:(0,k.jsx)(u.Z,{placeholder:"\u8bf7\u9009\u62e9\u8282\u70b9",onChange:e.handleChange,defaultValue:t.nodeName,children:i.map((function(e,t){return(0,k.jsx)(C,{value:e.id,children:e.nodeName},e.id)}))},t.nodeId)}),n>=1?(0,k.jsx)(b.Z,{className:"removejie",onClick:function(){return e.remove1(t,n)}}):null,(0,k.jsxs)(g.Z,{style:{marginBottom:"15px"},children:[t.powerUserNumber&&t.powerUserNumber.map((function(t,s){return(0,k.jsx)(f.Z.Item,{style:{marginBottom:"15px"},name:"zjiedian"+n+s,children:(0,k.jsxs)("div",{style:{padding:"10px 12px"},children:[(0,k.jsx)(Z.Z,{onClick:function(){return e.remove(n,s,t)}}),(0,k.jsx)(m.Z,{defaultValue:t,style:{width:"60%"}},t+s)]})},"zjiedian"+s)})),(0,k.jsxs)("a",{className:"hu",style:{display:0==l?"block":"none",color:"#fff"},onClick:function(){return e.add(t)},children:[(0,k.jsx)(y.Z,{})," \xa0\xa0\xa0\u6dfb\u52a0\u7535\u529b\u7528\u6237\u53f7"]})]})]}))}))]}),(0,k.jsxs)("a",{style:{marginLeft:110},onClick:function(){return e.add1()},children:[(0,k.jsx)(y.Z,{}),"\xa0\xa0\xa0\u6dfb\u52a0\u8282\u70b9\u9009\u62e9"]})]}),(0,k.jsx)(h.Z,{title:"\u67e5\u770b",width:740,visible:j,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",forceRender:!0,onOk:this.handleOk1,onCancel:this.handleCancel1,children:(0,k.jsxs)("div",{className:"bussiness1",children:[(0,k.jsxs)("div",{className:"bussiness",children:[(0,k.jsx)("h4",{children:this.state.ebussindess}),(0,k.jsx)("div",{className:"busindeecont",children:(0,k.jsxs)("ul",{children:[(0,k.jsxs)("li",{children:["\u8054\u7cfb\u4eba\uff1a",this.state.person]}),(0,k.jsxs)("li",{children:["\u516c\u53f8\u5730\u5740\uff1a",this.state.caddress]}),(0,k.jsxs)("li",{children:["\u7535\u8bdd\uff1a",this.state.tel]}),(0,k.jsxs)("li",{children:["\u516c\u53f8\u4e1a\u52a1\uff1a",this.state.buss]})]})})]}),p.length&&p.map((function(e,t){return(0,k.jsxs)("div",{className:"bussiness",children:[(0,k.jsx)("h4",{children:e.nodeName}),(0,k.jsx)("div",{className:"mapdivs",children:e.powerUserNumber.map((function(e,t){return(0,k.jsxs)("span",{children:["\u7535\u529b\u6237\u53f7\uff1a",e]})}))})]})}))]})})]})}}]),n}(r.Component),_=U,B=l.Z.TabPane,z=function(e){(0,o.Z)(n,e);var t=(0,i.Z)(n);function n(e){var a;return(0,s.Z)(this,n),(a=t.call(this,e)).state={},a}return(0,a.Z)(n,[{key:"onChange",value:function(){}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){}}},{key:"render",value:function(){return(0,k.jsx)("div",{className:"allcontent",children:(0,k.jsxs)(l.Z,{defaultActiveKey:"1",onChange:this.onChange,children:[(0,k.jsx)(B,{tab:"\u7535\u529b\u7528\u6237",children:(0,k.jsx)(c.Z,{})},"1"),(0,k.jsx)(B,{tab:"\u865a\u62df\u7535\u5382\u8fd0\u8425\u5546 ",children:(0,k.jsx)(_,{})},"2")]})})}}]),n}(r.Component)}}]);
//# sourceMappingURL=2237.56e9fe43.chunk.js.map
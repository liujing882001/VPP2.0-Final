"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[250],{50250:function(e,a,t){t.r(a),t.d(a,{default:function(){return H}});var s=t(1413),n=t(15671),i=t(43144),o=t(97326),d=t(60136),l=t(27277),c=t(72791),r=t(61855),m=t(66818),u=t(58768),h=t(13832),f=t(31773),y=t(74424),g=t(2556),p=t(78347),v=t(67049),x=t(93070),S=t(47195),Z=t(97943),k=t(15821),j=t(97892),b=t.n(j),I=t(35796),T=t(50446),C=t(79286),N=t(5122),L=t(80184),w=r.Z.Search,P=m.Z.Option,_=u.Z.confirm,F={wrapperCol:{offset:8,span:16}},D="HH:mm",V=function(e){(0,d.Z)(t,e);var a=(0,l.Z)(t);function t(e){var s;return(0,n.Z)(this,t),(s=a.call(this,e)).enter=function(){s.setState({isModalVisible:!0,edit:1})},s.handleOk=function(){s.setState({isModalVisible:!1})},s.handleCancel=function(){s.setState({isModalVisible:!1}),s.refs.myForm.resetFields()},s.obtain=function(){N.Z.get("ancillary_services/ancillary_task/getASTask").then((function(e){console.log(e),200==e.data.code?h.ZP.success("\u6210\u529f"):h.ZP.info(e.data.msg)})).catch((function(e){console.log(e)}))},s.onSearch=function(e){console.log(e),s.setState({deviceNames:e,loading1:!0},(function(){N.Z.post("ancillary_services/ancillary_task/getASDeviceListByName",{asId:s.state.asId,deviceName:s.state.deviceNames,number:s.state.pageinfo,pageSize:10}).then((function(e){if(console.log(e),200==e.data.code){var a=e.data.data.content;s.setState({editdataSource:a,loading1:!1})}})).catch((function(e){console.log(e)}))}))},s.addCancel=function(){s.setState({addVisible:!1}),s.refs.addmyForm.resetFields()},s.adddevices1=function(){s.nodeList(),s.setState({addVisible:!0})},s.addeCancel=function(){s.refs.addmyForm.resetFields(),s.setState({addVisible:!1})},s.edits=function(e){console.log(e),s.setState({edit:0,asId:e.asId,isModalVisible:!0},(function(){s.refs.myForm.setFieldsValue({asLoad:e.asLoad,asSubsidy:e.asSubsidy,asType:e.asType,assDate:b()(e.assDate,"YYYY-MM-DD"),assTime:[b()(e.assTime,"HH:mm"),b()(e.aseTime,"HH:mm")],taskCode:e.taskCode})}))},s.delet=function(e){console.log(e);var a=(0,o.Z)(s);_({title:"\u63d0\u793a",icon:(0,L.jsx)(I.Z,{}),content:"\u786e\u5b9a\u8981\u5220\u9664\u5417\uff1f",cancelText:"\u53d6\u6d88",okText:"\u786e\u5b9a",onOk:function(){console.log("OK"),N.Z.post("ancillary_services/ancillary_task/delASTask?asId="+e.asId).then((function(e){console.log(e),200==e.data.code?(h.ZP.success("\u5220\u9664\u6210\u529f"),a.getASTaskList()):h.ZP.info(e.data.msg)})).catch((function(e){}))},onCancel:function(){console.log("Cancel")}})},s.editCancel=function(){s.setState({editVisible:!1})},s.lookover=function(e){console.log(e),s.setState({editVisible:!0,asId:e.asId,asType:e.asType,loading1:!0,astatus:e.astatus},(function(){N.Z.post("ancillary_services/ancillary_task/getASDeviceListByName",{asId:e.asId,deviceName:s.state.deviceNames,number:s.state.pageinfo,pageSize:1e5}).then((function(e){if(console.log(e),200==e.data.code){for(var a=e.data.data.content,t=0,n=0;n<a.length;n++)t+=Number(a[n].deviceRatedPower);s.setState({inconem:t})}})).catch((function(e){console.log(e)})),N.Z.post("ancillary_services/ancillary_task/getASDeviceListByName",{asId:e.asId,deviceName:s.state.deviceNames,number:s.state.pageinfo,pageSize:10}).then((function(e){if(console.log(e),200==e.data.code){var a=e.data.data.content;s.setState({editdataSource:a,loading1:!1,totalinfo:e.data.data.totalElements})}})).catch((function(e){console.log(e)}))}))},s.chosenode=function(e){console.log(e);for(var a=s.state.nodeList,t=(0,o.Z)(s),n=[],i=0;i<a.length;i++)e==a[i].id&&s.setState({nodeName:a[i].name});s.setState({nodeId:e}),N.Z.post("system_management/node_model/nodeSystemList?nodeId="+e).then((function(e){if(console.log(e),200==e.data.code){var a=e.data.data;console.log(e.data.data[0].id),a.map((function(e){n.push({id:e.id,systemName:e.systemName})})),t.setState({visabled:!0,nodeSystemList:n,secondCity:""},(function(){console.log(t.state.nodeSystemList),s.refs.addmyForm.setFieldsValue({system:"",devices:""})}))}}))},s.chosesystem=function(e){console.log(e);for(var a=s.state,t=a.nodeId,n=a.nodeSystemList,i=0;i<n.length;i++)e==n[i].id&&s.setState({systemName:n[i].systemName});s.setState({systemId:e}),N.Z.post("system_management/device_model/deviceList?nodeId="+t+"&systemId="+e).then((function(e){console.log(e),200==e.data.code&&s.setState({deviceList:e.data.data},(function(){s.refs.addmyForm.setFieldsValue({devices:""})}))}))},s.chosedevice=function(e){var a=s.state.deviceList;s.setState({deviceId:e});for(var t=0;t<a.length;t++)e==a[t].deviceId&&s.setState({deviceName:a[t].deviceName})},s.onChange=function(e){console.log(e);var a=(0,o.Z)(s);if(e){var t=new URLSearchParams;t.append("actualLoad",2==e.sstatus?e.deviceRatedPower:0),t.append("deviceRatedPower",e.deviceRatedPower),t.append("sId",e.sid),t.append("sStatus",1==e.sstatus?2:2==e.sstatus?1:""),_({title:"\u63d0\u793a",icon:(0,L.jsx)(I.Z,{}),content:"\u786e\u5b9a\u8981\u8986\u76d6\u5417",cancelText:"\u53d6\u6d88",okText:"\u786e\u5b9a",onOk:function(){console.log("OK"),N.Z.post("ancillary_services/ancillary_task/editASStrategy",t,{headers:{"content-type":"application/x-www-form-urlencoded"}}).then((function(e){console.log(e),200==e.data.code?(h.ZP.success(e.data.msg),N.Z.post("ancillary_services/ancillary_task/getASDeviceListByName",{asId:a.state.asId,deviceName:a.state.deviceNames,number:a.state.pageinfo,pageSize:10}).then((function(e){if(console.log(e),200==e.data.code){var t=e.data.data.content;a.setState({editdataSource:t},(function(){}))}})).catch((function(e){console.log(e)}))):h.ZP.success(e.data.msg)})).catch((function(e){console.log(e)}))},onCancel:function(){console.log("Cancel")}})}},s.state={dataSource:[],isModalVisible:!1,editVisible:!1,addVisible:!1,page:1,edit:0,asId:"",editdataSource:[],nodeList:[],nodeSystemList:[],nodeId:"",systemId:"",deviceList:[],nodeName:"",systemName:"",deviceName:"",deviceId:"",value:"",deviceNames:"",asType:"",loading:!1,inconem:"",astatus:"",total:"",pageinfo:1,totalinfo:"",loading1:!1},s}return(0,i.Z)(t,[{key:"componentDidMount",value:function(){this.getASTaskList()}},{key:"getASTaskList",value:function(){var e=this,a=this.state.page;this.setState({loading:!0}),N.Z.post("ancillary_services/ancillary_task/getASTaskList",{number:a,pageSize:10}).then((function(a){if(console.log(a),200==a.data.code){var t=a.data.data.content;t.sort((function(e,a){return a.taskCode<e.taskCode?-1:1})),e.setState({dataSource:t,loading:!1,total:a.data.data.totalElements})}})).catch((function(e){console.log(e)}))}},{key:"nodeList",value:function(){var e=this;N.Z.post("system_management/node_model/nodeList").then((function(a){console.log(a),200==a.data.code&&e.setState({nodeList:a.data.data})})).catch((function(e){}))}},{key:"render",value:function(){var e=this,a=this.state,t=a.dataSource,n=a.isModalVisible,i=a.editVisible,o=a.addVisible,d=a.nodeName,l=a.systemName,c=a.deviceName,j=(a.value,a.edit),I=a.asId,_=a.editdataSource,V=a.nodeList,H=a.nodeSystemList,A=a.deviceList,M=a.asType,Y=a.loading,R=(a.inconem,a.page),z=a.loading1,W=[{title:"\u5e8f\u53f7",width:"10%",render:function(e,a,t){return 10*(R-1)+t+1}},{title:"\u4efb\u52a1\u7f16\u7801",dataIndex:"taskCode",key:"taskCode",render:function(e){return(0,L.jsx)("a",{children:e})}},{title:"\u8f85\u52a9\u670d\u52a1\u65f6\u6bb5",dataIndex:"age",key:"age",render:function(e,a,t){return a.assDate+"    "+a.assTime+"~"+a.aseTime}},{title:"\u8f85\u52a9\u670d\u52a1\u89c4\u6a21\uff08kW\uff09",dataIndex:"asLoad",key:"asLoad"},{title:"\u8f85\u52a9\u670d\u52a1\u7c7b\u578b",dataIndex:"asType",key:"asType",render:function(e,a,t,s){return 1==a.asType?"\u8c03\u5cf0":2==a.asType?"\u8c03\u9891":3==a.asType?"\u5907\u7528":void 0}},{title:"\u8865\u8d34\uff08\u5143/kWh\uff09",dataIndex:"asSubsidy",key:"asSubsidy"},{title:"\u7b56\u7565",dataIndex:"address",key:"address",render:function(a,t,s,n){return 1==t.astatus&&3==t.asType?(0,L.jsx)("a",{onClick:function(){return e.lookover(t)},children:"\u67e5\u770b"}):1==t.astatus&&2==t.asType||1==t.astatus&&1==t.asType?(0,L.jsx)("a",{onClick:function(){return e.lookover(t)},children:"\u7f16\u8f91"}):2==t.astatus&&3==t.asType?(0,L.jsx)("a",{onClick:function(){return e.lookover(t)},children:"\u67e5\u770b"}):2==t.astatus&&2==t.asType||2==t.astatus&&1==t.asType?(0,L.jsx)("a",{disabled:!0,children:"\u7f16\u8f91"}):3==t.astatus&&3==t.asType?(0,L.jsx)("a",{onClick:function(){return e.lookover(t)},children:"\u67e5\u770b"}):3==t.astatus&&2==t.asType||3==t.astatus&&1==t.asType?(0,L.jsx)("a",{disabled:!0,children:"\u7f16\u8f91"}):void 0}},{title:"\u64cd\u4f5c",key:"action",render:function(a,t,s,n){return 2==t.astatus||3==t.astatus?(0,L.jsxs)(f.Z,{size:"middle",children:[(0,L.jsx)("a",{disabled:!0,children:"\u7f16\u8f91"}),(0,L.jsx)("a",{disabled:!0,children:"\u5220\u9664"})]}):1==t.astatus?(0,L.jsxs)(f.Z,{size:"middle",children:[(0,L.jsx)("a",{onClick:function(){return e.edits(t)},children:"\u7f16\u8f91"}),(0,L.jsx)("a",{onClick:function(){return e.delet(t)},children:"\u5220\u9664"})]}):void 0}}],q=[{title:"\u8282\u70b9",dataIndex:"nodeName",key:"nodeName",width:"15%"},{title:"\u7cfb\u7edf",dataIndex:"systemName",key:"systemName",width:"15%"},{title:"\u8bbe\u5907",dataIndex:"deviceName",key:"deviceName",width:"15%"},{title:"\u989d\u5b9a\u8d1f\u8377\uff08kW\uff09",dataIndex:"deviceRatedPower",key:"deviceRatedPower"},{title:"\u5b9e\u65f6\u8d1f\u8377\uff08kW\uff09",dataIndex:"actualLoad",key:"actualLoad"},{title:"\u5f53\u524d\u72b6\u6001",dataIndex:"sstatus",key:"sstatus",render:function(e,a,t){return 1==a.sstatus?"\u5f00\u542f":2==a.sstatus?"\u5173\u95ed":void 0}},{title:"\u6267\u884c\u7b56\u7565",dataIndex:"sstatus",key:"sstatus",render:function(a,t,s){return(0,L.jsxs)(y.ZP.Group,{onChange:function(){e.onChange(t)},value:t.sstatus,disabled:3==e.state.asType||(2==t.astatus||(3==t.astatus||(t.astatus,!1))),children:[(0,L.jsx)(y.ZP,{value:1,children:"\u5f00\u542f"}),(0,L.jsx)(y.ZP,{value:2,children:"\u5173\u95ed"})]})}}],O=function(e){console.log("Failed:",e)};return(0,L.jsxs)("div",{className:"task",children:[(0,L.jsxs)("div",{className:"ServiceTaskheader",children:[(0,L.jsx)(g.ZP,{type:"primary",icon:(0,L.jsx)(T.Z,{}),onClick:this.obtain,children:"\u81ea\u52a8\u83b7\u53d6\u4efb\u52a1"}),(0,L.jsx)(g.ZP,{type:"primary",onClick:this.enter,style:{float:"right"},icon:(0,L.jsx)(C.Z,{}),children:"\u5f55\u5165\u670d\u52a1\u4efb\u52a1"})]}),(0,L.jsx)("div",{children:(0,L.jsx)(p.Z,{dataSource:t,columns:W,loading:Y,onChange:function(a){console.log(a),e.setState({page:a.current},(function(){e.getASTaskList()}))},pagination:{total:this.state.total,defaultCurrent:1,defaultPageSize:10,showSizeChanger:!1}})}),(0,L.jsxs)(v.ZP,{locale:k.Z,children:[(0,L.jsx)(u.Z,{title:0==j?"\u7f16\u8f91":"\u5f55\u5165\u670d\u52a1\u4efb\u52a1",visible:n,footer:null,width:740,onCancel:this.handleCancel,children:(0,L.jsxs)(x.Z,{name:"basic",labelCol:{span:6},wrapperCol:{span:18},initialValues:{remember:!0},onFinish:function(a){console.log("Success:",a),console.log(a.assTime[0].format("HHmm"));var t=a.assDate.format("YYYYMMDD")+a.assTime[0].format("HHmm")+a.assTime[1].format("HHmm");0==j?N.Z.post("ancillary_services/ancillary_task/editASTask",{asId:I,asLoad:a.asLoad,asSubsidy:a.asSubsidy,asType:a.asType,aseTime:a.assTime[1].format("HH:mm"),assDate:a.assDate.format("YYYY-MM-DD"),assTime:a.assTime[0].format("HH:mm"),taskCode:t}).then((function(a){console.log(a),200==a.data.code?(h.ZP.success("\u7f16\u8f91\u6210\u529f"),e.setState({isModalVisible:!1},(function(){e.getASTaskList(),e.refs.myForm.resetFields()}))):h.ZP.success(a.data.msg)})).catch((function(e){console.log(e)})):1==j&&N.Z.post("ancillary_services/ancillary_task/addASTask",{asId:"",asLoad:a.asLoad,asSubsidy:a.asSubsidy,asType:a.asType,aseTime:a.assTime[1].format("HH:mm"),assDate:a.assDate.format("YYYY-MM-DD"),assTime:a.assTime[0].format("HH:mm"),taskCode:t}).then((function(a){console.log(a),200==a.data.code?(h.ZP.success("\u6210\u529f"),e.getASTaskList(),e.setState({isModalVisible:!1}),e.refs.myForm.resetFields()):h.ZP.info(a.data.msg)})).catch((function(e){console.log(e)}))},onFinishFailed:O,autoComplete:"off",ref:"myForm",children:[(0,L.jsxs)(x.Z.Item,{label:"\u8f85\u52a9\u54cd\u5e94\u65f6\u6bb5",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8f85\u52a9\u54cd\u5e94\u65f6\u6bb5"}],name:"assDate",children:[(0,L.jsx)(x.Z.Item,{name:"assDate",style:{display:"inline-block",width:"calc(50% - 0px)"},children:(0,L.jsx)(S.Z,{style:{width:"100%",marginLeft:0},disabledDate:function(e){return e&&e<b()().subtract(1,"day")}})}),(0,L.jsx)(x.Z.Item,{style:{display:"inline-block",width:"calc(50% - 0px)"},name:"assTime",children:(0,L.jsx)(Z.Z.RangePicker,{defaultValue:b()("00:00",D),format:D})})]}),(0,L.jsx)(x.Z.Item,{label:"\u4efb\u52a1\u7f16\u7801",name:"taskCode",extra:"\u547d\u540d\u89c4\u8303\uff1a2022071313001600  \u7f16\u53f7\u89c4\u5219\uff1a\u5e74\u6708\u65e5\u5f00\u59cb\u7ed3\u675f\u65f6\u95f4\u4efb\u52a1\u7f16\u7801\u6839\u636e\u54cd\u5e94\u65f6\u6bb5\u81ea\u52a8\u751f\u6210",children:(0,L.jsx)(r.Z,{disabled:!0})}),(0,L.jsxs)(x.Z.Item,{label:"\u8f85\u52a9\u670d\u52a1\u89c4\u6a21",children:[(0,L.jsx)(x.Z.Item,{name:"asLoad",style:{width:"63%",float:"left"},rules:[{pattern:new RegExp(/^(([1-9][0-9]{0,5})|0|1000000)$/),message:"\u8bf7\u8f93\u5165\u6b63\u786e\u8303\u56f4\u5185\u7684\u6570\u5b57"}],children:(0,L.jsx)(r.Z,{})}),(0,L.jsx)("span",{className:"ant-form-text",children:" kW"})]}),(0,L.jsx)(x.Z.Item,{label:"\u8f85\u52a9\u670d\u52a1\u89c4\u6a21\u7c7b\u578b",name:"asType",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8f85\u52a9\u670d\u52a1\u89c4\u6a21\u7c7b\u578b"}],children:(0,L.jsxs)(m.Z,{placeholder:"\u8f85\u52a9\u670d\u52a1\u89c4\u6a21\u7c7b\u578b",style:{width:"70%"},children:[(0,L.jsx)(P,{value:"1",children:"\u8c03\u5cf0"}),(0,L.jsx)(P,{value:"2",children:"\u8c03\u9891"})]})}),(0,L.jsxs)(x.Z.Item,{label:"\u54cd\u5e94\u8865\u8d34",children:[(0,L.jsx)(x.Z.Item,{name:"asSubsidy",style:{width:"58%",float:"left"},rules:[{required:!0,pattern:new RegExp(/^(([1-9][0-9]{0,5})|0|1000000)$/),message:"\u8bf7\u8f93\u5165\u6b63\u786e\u8303\u56f4\u5185\u7684\u6570\u5b57"}],children:(0,L.jsx)(r.Z,{maxLength:50})}),(0,L.jsx)("span",{className:"ant-form-text",children:" \u5143/kWh"})]}),(0,L.jsxs)(x.Z.Item,(0,s.Z)((0,s.Z)({},F),{},{children:[(0,L.jsx)(g.ZP,{style:{marginRight:20},onClick:this.handleCancel,children:"\u53d6\u6d88"}),(0,L.jsx)(g.ZP,{type:"primary",htmlType:"submit",children:"\u786e\u5b9a"})]}))]})}),(0,L.jsxs)(u.Z,{title:3==M?"\u67e5\u770b\u7b56\u7565":"\u7f16\u8f91\u7b56\u7565",visible:i,footer:null,width:740,onCancel:this.editCancel,children:[(0,L.jsxs)("div",{className:"tactics",children:[(0,L.jsx)("p",{children:"\u53ef\u54cd\u5e94\u8d1f\u8377\uff08kW\uff09"}),(0,L.jsx)("span",{children:this.state.inconem})]}),(0,L.jsx)("div",{className:"serches",children:(0,L.jsx)(w,{placeholder:"\u641c\u7d22\u8bbe\u5907",onSearch:this.onSearch,style:{width:200,marginRight:20}})}),(0,L.jsx)(p.Z,{dataSource:_,columns:q,bordered:!0,loading:z,onChange:function(a){console.log(a),e.setState({pageinfo:a.current,loading1:!0},(function(){N.Z.post("ancillary_services/ancillary_task/getASDeviceListByName",{asId:e.state.asId,deviceName:e.state.deviceNames,number:e.state.pageinfo,pageSize:10}).then((function(a){if(console.log(a),200==a.data.code){var t=a.data.data.content;e.setState({editdataSource:t,loading1:!1,totalinfo:a.data.data.totalElements})}})).catch((function(e){console.log(e)}))}))},pagination:{total:this.state.totalinfo,defaultCurrent:1,defaultPageSize:10,showSizeChanger:!1}})]}),(0,L.jsx)(u.Z,{title:"\u6dfb\u52a0\u8bbe\u5907",visible:o,footer:null,width:640,onCancel:this.addCancel,children:(0,L.jsxs)(x.Z,{name:"basic",labelCol:{span:8},wrapperCol:{span:12},onFinish:function(a){console.log("Success:",a),N.Z.post("ancillary_services/ancillary_task/addASStrategy",{actualLoad:0,asId:I,deviceId:a.devices,deviceName:c,deviceRatedPower:0,nodeId:a.nodeId,nodeName:d,sid:"",sstatus:2,systemId:a.system,systemName:l}).then((function(a){console.log(a),200==a.data.code?(h.ZP.success("\u6dfb\u52a0\u8bbe\u5907\u6210\u529f"),e.setState({addVisible:!1}),e.refs.myForm.resetFields()):h.ZP.info(a.data.msg)}))},onFinishFailed:O,ref:"addmyForm",children:[(0,L.jsx)(x.Z.Item,{label:"\u8282\u70b9",name:"nodeId",rules:[{required:!0,message:"\u9009\u62e9\u8282\u70b9"}],children:(0,L.jsx)(m.Z,{placeholder:"\u9009\u62e9\u8282\u70b9",onChange:this.chosenode,children:V.length&&V.map((function(e){return(0,L.jsx)(P,{value:e.id,children:e.name},e.id)}))})}),(0,L.jsx)(x.Z.Item,{label:"\u7cfb\u7edf",name:"system",rules:[{required:!0,message:"\u9009\u62e9\u7cfb\u7edf"}],children:(0,L.jsx)(m.Z,{placeholder:"\u9009\u62e9\u7cfb\u7edf",onChange:this.chosesystem,children:H.length&&H.map((function(e){return(0,L.jsx)(P,{value:e.id,children:e.systemName},e.id)}))})}),(0,L.jsx)(x.Z.Item,{label:"\u8bbe\u5907",name:"devices",rules:[{required:!0,message:"\u9009\u62e9\u8bbe\u5907"}],children:(0,L.jsx)(m.Z,{placeholder:"\u9009\u62e9\u8bbe\u5907",onChange:this.chosedevice,children:A.length&&A.map((function(e){return(0,L.jsx)(P,{value:e.deviceId,children:e.deviceName},e.deviceId)}))})}),(0,L.jsxs)(x.Z.Item,(0,s.Z)((0,s.Z)({},F),{},{children:[(0,L.jsx)(g.ZP,{style:{marginRight:20},onClick:this.addeCancel,type:"primary",children:"\u53d6\u6d88"}),(0,L.jsx)(g.ZP,{type:"primary",htmlType:"submit",children:"\u786e\u5b9a"})]}))]})})]})]})}}]),t}(c.Component),H=V}}]);
//# sourceMappingURL=250.51e8e2c0.chunk.js.map